// Copyright 2019 Istio Authors
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.


syntax = 'proto3';

import "google/protobuf/duration.proto";
import "k8s.io/api/core/v1/generated.proto";

package values;

// Package-wide variables from generator "generated".
option go_package = "v1alpha2";

// AddonIngressConfig is described in istio.io documentation.
message AddonIngressConfig {
  bool enabled = 1;

  repeated string hosts = 2;
}

// ArchConfig is described in istio.io documentation.
message ArchConfig {
  // Sets pod scheduling weight for amd64 arch
  uint32 amd64 = 1;

  // Sets pod scheduling weight for ppc64le arch.
  uint32 ppc64le = 2;

  // Sets pod scheduling weight for s390x arch.
  uint32 s390x = 3;
}

// CNIConfig is described in istio.io documentation.
message CNIConfig {
  bool enabled = 1;
}

// CPUTargetUtilizationConfig is described in istio.io documentation.
message CPUTargetUtilizationConfig {
  int32 targetAverageUtilization = 1;
}

// CertManagerConfig is a set of configuration parameters for CertManager.
message CertManagerConfig {
  // Controls whether CertManager is enabled.
  bool enabled = 1;

  // Image hub for the CertManager Deployment.
  string hub = 2;

  // K8s node selector.
  //
  // See https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector
  // 	NodeSelector map[string]interface{} `json:"nodeSelector"`

  // K8s resources settings.
  //
  // See https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#resource-requests-and-limits-of-pod-and-container
  k8s.io.api.core.v1.ResourceRequirements resources = 3;

  // Image tag for the CertManager Deployment.
  string tag = 4;
}

// CoreDNSConfig is described in istio.io documentation.
message CoreDNSConfig {
  string coreDNSImage = 1;

  string coreDNSPluginImage = 2;

  bool enabled = 3;

  // 	NodeSelector       map[string]interface{} `json:"nodeSelector,omitempty"`
  uint32 replicaCount = 4;
}

// DefaultPodDisruptionBudgetConfig is described in istio.io documentation.
message DefaultPodDisruptionBudgetConfig {
  // k8s PodDisruptionBudget settings.
  bool enabled = 1;
}

// DefaultResourcesConfig is described in istio.io documentation.
message DefaultResourcesConfig {
  // k8s resources settings.
  ResourcesRequestsConfig requests = 1;
}

// EgressGatewayConfig is described in istio.io documentation.
message EgressGatewayConfig {
  bool autoscaleEnabled = 1;

  uint32 autoscaleMax = 2;

  uint32 autoscaleMin = 3;

  string connectTimeout = 4;

  CPUTargetUtilizationConfig cpu = 5;

  google.protobuf.Duration drainDuration = 6;

  bool enabled = 7;

  map<string, string> env = 8;

  GatewayLabelsConfig labels = 9;

  map<string, string> nodeSelector = 10;

  // 	PodAnnotations                   map[string]interface{}      `json:"podAnnotations,omitempty"`
  // 	PodAntiAffinityLabelSelector     []map[string]interface{}    `json:"podAntiAffinityLabelSelector"`
  // 	PodAntiAffinityTermLabelSelector []map[string]interface{}    `json:"podAntiAffinityTermLabelSelector"`
  repeated PortsConfig ports = 11;

  k8s.io.api.core.v1.ResourceRequirements resources = 12;

  repeated SecretVolume secretVolumes = 13;

  // 	ServiceAnnotations               map[string]interface{}      `json:"serviceAnnotations,omitempty"`
  //    Type                             v1.ServiceType          `json:"type,omitempty"`
  ZeroVPNConfig zvpn = 14;
}

// EnvoyMetricsConfig is described in istio.io documentation.
message EnvoyMetricsConfig {
  // Enables the Envoy Metrics Service.
  bool enabled = 1;

  // Sets the destination Envoy Metrics Service address in Envoy.
  string host = 2;

  // Sets the destination Envoy Metrics Service port in Envoy.
  int32 port = 3;
}

// GalleyConfig is a set of configuration parameters for Galley.
message GalleyConfig {
  // Controls whether Galley is enabled.
  bool enabled = 1;

  // Image name used for Galley.
  //
  // This can be set either to image name if hub is also set in global.hub, or can be set to the full hub:name string.
  //
  // Examples: custom-galley, docker.io/someuser:custom-galley
  string image = 2;

  // TODO: Galley appears to use the mesh config - need to find which fields are used and need to be configured (https://github.com/istio/istio/issues/15865).
  map<string, string> mesh = 3;

  // Pod anti-affinity label selector.
  //
  // Specify the pod anti-affinity that allows you to constrain which nodes
  // your pod is eligible to be scheduled based on labels on pods that are
  // already running on the node rather than based on labels on nodes.
  // There are currently two types of anti-affinity:
  //    "requiredDuringSchedulingIgnoredDuringExecution"
  //    "preferredDuringSchedulingIgnoredDuringExecution"
  // which denote “hard” vs. “soft” requirements, you can define your values
  // in "podAntiAffinityLabelSelector" and "podAntiAffinityTermLabelSelector"
  // correspondingly.
  // See https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity
  //
  // Examples:
  // podAntiAffinityLabelSelector:
  //  - key: security
  //    operator: In
  //    values: S1,S2
  //    topologyKey: "kubernetes.io/hostname"
  //  This pod anti-affinity rule says that the pod requires not to be scheduled
  //  onto a node if that node is already running a pod with label having key
  //  “security” and value “S1”.
  //  PodAntiAffinityLabelSelector     []map[string]interface{}    `json:"podAntiAffinityLabelSelector"`

  // See PodAntiAffinityLabelSelector.
  //  PodAntiAffinityTermLabelSelector []map[string]interface{}    `json:"podAntiAffinityTermLabelSelector"`

  // Number of replicas in the Galley Deployment.
  uint32 replicaCount = 4;

  // K8s resources settings.
  //
  // See https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#resource-requests-and-limits-of-pod-and-container
  k8s.io.api.core.v1.ResourceRequirements resources = 5;
}

// GatewayLabelsConfig is described in istio.io documentation.
message GatewayLabelsConfig {
  string app = 1;

  string istio = 2;
}

// GatewaysConfig is described in istio.io documentation.
message GatewaysConfig {
  EgressGatewayConfig istio_egressgateway = 1;

  bool enabled = 2;

  ILBGatewayConfig istio_ilbgateway = 3;

  IngressGatewayConfig istio_ingressgateway = 4;
}

message GlobalConfig {
  ArchConfig arch = 30;

  // Configuration validation component namespace
  string configNamespace = 1;

  // Enables server-side validation of configuration.
  bool configValidation = 2;

  // Enables MTLS for control plane.
  bool controlPlaneSecurityEnabled = 3;

  // K8s NodeSelector
  map<string, string> defaultNodeSelector = 31;

  // k8s PodDisruptionBudget settings.
  DefaultPodDisruptionBudgetConfig defaultPodDisruptionBudget = 4;

  // Selects whether policy enforcement is installed.
  bool disablePolicyChecks = 5;

  DefaultResourcesConfig defaultResources = 6;

  // Enable helm test
  bool enableHelmTest = 7;

  // Enables tracing.
  bool enableTracing = 8;

  // Root for docker image paths.
  string hub = 9;

  // ImagePullPolicy             v1.PullPolicy                 `json:"imagePullPolicy,omitempty"`
  // Default namespace.
  string istioNamespace = 10;

  map<string, string> localityLbSetting = 32;

  KubernetesIngressConfig k8sIngress = 11;

  GlobalLoggingConfig logging = 12;

  MeshExpansionConfig meshExpansion = 13;

  map<string, string> meshNetworks = 33;

  // Monitor port number for all control plane components.
  uint32 monitoringPort = 14;

  MTLSConfig mtls = 15;

  MultiClusterConfig multiCluster = 16;

  // Restricts the applications namespace that the controller manages.
  bool oneNamespace = 17;

  OutboundTrafficPolicyConfig outboundTrafficPolicy = 18;

  // If set, allows traffic in cases when the mixer policy service cannot be reached.
  bool policyCheckFailOpen = 19;

  // Namespace of policy components
  string policyNamespace = 20;

  // k8s priorityClassName.
  string priorityClassName = 21;

  ProxyConfig proxy = 22;

  ProxyInitConfig proxy_init = 23;

  SDSConfig sds = 24;

  // Version tag for docker images.
  string tag = 25;

  // Namespace of telemetry components
  string telemetryNamespace = 26;

  // TracerConfig is a set of configuration parameters for different tracer.
  TracerConfig tracer = 27;

  // Specifies the trust domain that corresponds to the root cert of CA.
  string trustDomain = 28;

  // Selects use of Mesh Configuration Protocol to configure Pilot.
  bool useMCP = 29;
}

// GlobalLoggingConfig is described in istio.io documentation.
message GlobalLoggingConfig {
  string level = 1;
}

// ILBGatewayConfig is described in istio.io documentation.
message ILBGatewayConfig {
  bool autoscaleEnabled = 1;

  uint32 autoscaleMax = 2;

  uint32 autoscaleMin = 3;

  bool enabled = 4;

  CPUTargetUtilizationConfig cpu = 5;

  GatewayLabelsConfig labels = 6;

  string loadBalancerIP = 7;

  // 	NodeSelector       map[string]interface{}      `json:"nodeSelector,omitempty"`
  // 	PodAnnotations     map[string]interface{}      `json:"podAnnotations,omitempty"`
  repeated PortsConfig ports = 8;

  k8s.io.api.core.v1.ResourceRequirements resources = 9;

  repeated SecretVolume secretVolumes = 10;
  //    ServiceAnnotations map[string]interface{}      `json:"serviceAnnotations,omitempty"`
//      Type               v1.ServiceType          `json:"type,omitempty"`
}

// IngressGatewayConfig is described in istio.io documentation.
message IngressGatewayConfig {
  bool autoscaleEnabled = 1;

  uint32 autoscaleMax = 2;

  uint32 autoscaleMin = 3;

  string connectTimeout = 4;

  CPUTargetUtilizationConfig cpu = 5;

  bool customService = 6;

  string debug = 7;

  string domain = 8;

  google.protobuf.Duration drainDuration = 9;

  bool enabled = 10;

  map<string, string> env = 11;

  repeated string externalIPs = 12;

  bool k8sIngress = 13;

  bool k8sIngressHttps = 14;

  GatewayLabelsConfig labels = 15;

  string loadBalancerIP = 16;

  repeated string loadBalancerSourceRanges = 17;

  repeated PortsConfig meshExpansionPorts = 18;

  // 	NodeSelector                     map[string]interface{}      `json:"nodeSelector,omitempty"`
  // 	PodAnnotations                   map[string]interface{}      `json:"podAnnotations,omitempty"`
  // 	PodAntiAffinityLabelSelector     []map[string]interface{}    `json:"podAntiAffinityLabelSelector"`
  // 	PodAntiAffinityTermLabelSelector []map[string]interface{}    `json:"podAntiAffinityTermLabelSelector"`
  repeated PortsConfig ports = 19;

  uint32 replicaCount = 20;

  // 	Resources                        map[string]interface{}      `json:"resources,omitempty"`
  IngressGatewaySdsConfig sds = 21;

  repeated SecretVolume secretVolumes = 22;

  // 	ServiceAnnotations               map[string]interface{}      `json:"serviceAnnotations,omitempty"`
  //    Type                             v1.ServiceType          `json:"type,omitempty"`
  IngressGatewayZvpnConfig zvpn = 23;
}

// IngressGatewaySdsConfig is described in istio.io documentation.
message IngressGatewaySdsConfig {
  bool enabled = 1;

  string image = 2;
}

// IngressGatewayZvpnConfig is described in istio.io documentation.
message IngressGatewayZvpnConfig {
  bool enabled = 1;

  string suffix = 2;
}

// Configuration parameters for Kubernetes environment adapter in mixer.
message KubernetesEnvMixerAdapterConfig {
  // Enables the Kubernetes env adapter in Mixer.
  //
  // See: https://istio.io/docs/reference/config/policy-and-telemetry/adapters/kubernetesenv/
  bool enabled = 1;
}

// KubernetesIngressConfig represents the configuration for Kubernetes Ingress.
message KubernetesIngressConfig {
  // Enables gateway for legacy k8s Ingress.
  bool enabled = 1;

  // Enables gateway for legacy k8s Ingress.
  bool enableHttps = 2;

  // Sets the gateway name for legacy k8s Ingress.
  string gatewayName = 3;
}

// LoadSheddingConfig configs when mixer starts rejecting grpc requests.
message LoadSheddingConfig {
  string latencyThreshold = 1;

  // Different throttling behavior for mixer.
  enum mode {
    // Removes throttling behavior for mixer.
    DISABLED = 0;
    // Enables an advisory mode for throttling behavior for mixer.
    LOG_ONLY = 1;
    // Turn on throttling behavior for mixer.
    ENFORCE = 2;
  }
}

// MTLSConfig is described in istio.io documentation.
message MTLSConfig {
  // Enables MTLS for service to service traffic.
  bool enabled = 1;
}

// MeshExpansionConfig is described in istio.io documentation.
message MeshExpansionConfig {
  // Exposes Pilot and Citadel mTLS on the ingress gateway.
  bool enabled = 1;

  // Exposes Pilot and Citadel mTLS and the plain text Pilot ports on an internal gateway.
  bool useILB = 2;
}

// MixerAdaptersConfig is a set of configuration parameters for different mixer adapters.
message MixerAdaptersConfig {
  // Configuration parameters for Kubernetes environment adapter in mixer.
  KubernetesEnvMixerAdapterConfig kubernetesenv = 1;

  // Configuration parameters for Prometheus adapter in mixer.
  PrometheusMixerAdapterConfig prometheus = 2;

  // Configuration parameters for stdio adapter in mixer, recommended for debug usage only.
  StdioMixerAdapterConfig stdio = 3;

  // Sets the --useAdapterCRDs mixer startup argument.
  bool useAdapterCRDs = 4;
}

// MixerConfig is described in istio.io documentation.
message MixerConfig {
  // MixerPolicyConfig is set of configurations for Mixer Policy
  MixerPolicyConfig policy = 1;

  // MixerTelemetryConfig is set of configurations for Mixer Telemetry
  MixerTelemetryConfig telemetry = 2;
}

// MixerPolicyConfig is set of configurations for Mixer Policy
message MixerPolicyConfig {
  // Controls whether a HorizontalPodAutoscaler is installed for Mixer Policy.
  bool autoscaleEnabled = 1;

  // Maximum number of replicas in the HorizontalPodAutoscaler for Mixer Policy.
  uint32 autoscaleMax = 2;

  // Minimum number of replicas in the HorizontalPodAutoscaler for Mixer Policy.
  uint32 autoscaleMin = 3;

  // Target CPU utilization used in HorizontalPodAutoscaler.
  //
  // See https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/
  CPUTargetUtilizationConfig cpu = 4;

  // Controls whether Mixer Policy is enabled
  bool enabled = 5;

  // Image name used for Mixer Policy.
  //
  // This can be set either to image name if hub is also set, or can be set to the full hub:name string.
  //
  // Examples: custom-mixer, docker.io/someuser:custom-mixer
  string image = 6;

  // K8s annotations to attach to mixer policy deployment
  //
  // See: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/
  // PodAnnotations   map[string]interface{}      `json:"podAnnotations,omitempty"`

  // Number of replicas in the Mixer Policy Deployment
  uint32 replicaCount = 7;
}

// MixerTelemetryConfig is a set of configuration parameters for Mixer Telemetry
message MixerTelemetryConfig {
  // MixerAdaptersConfig is a set of configuration parameters for different mixer adapters.
  MixerAdaptersConfig adapters = 1;

  // Controls whether a HorizontalPodAutoscaler is installed for Mixer Telemetry.
  bool autoscaleEnabled = 2;

  // Maximum number of replicas in the HorizontalPodAutoscaler for Mixer Telemetry.
  uint32 autoscaleMax = 3;

  // Minimum number of replicas in the HorizontalPodAutoscaler for Mixer Telemetry.
  uint32 autoscaleMin = 4;

  // Target CPU utilization used in HorizontalPodAutoscaler.
  //
  // See https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/
  CPUTargetUtilizationConfig cpu = 5;

  // Controls whether Mixer Telemetry is enabled
  bool enabled = 6;

  // Environment variables passed to the Mixer container.
  //
  // Examples:
  // env:
  //   ENV_VAR_1: value1
  //   ENV_VAR_2: value2
  map<string, string> env = 7;

  // Image name used for Mixer Telemetry.
  //
  // This can be set either to image name if hub is also set, or can be set to the full hub:name string.
  //
  // Examples: custom-mixer, docker.io/someuser:custom-mixer
  string image = 8;

  // LoadSheddingConfig configs when mixer starts rejecting grpc requests.
  LoadSheddingConfig loadshedding = 9;
  // K8s node selector.
  //
  // See https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector
  // NodeSelector           map[string]interface{}     `json:"nodeSelector,omitempty"`

  // K8s annotations to attach to mixer telemetry deployment
  //
  // See: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/
  // PodAnnotations         map[string]interface{}     `json:"podAnnotations,omitempty"`

  // Number of replicas in the Mixer Telemetry Deployment.
  uint32 replicaCount = 10;

  // K8s resources settings.
  //
  // See https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#resource-requests-and-limits-of-pod-and-container
  k8s.io.api.core.v1.ResourceRequirements resources = 11;

  // Controls whether to enable the sticky session setting when choosing backend pods.
  bool sessionAffinityEnabled = 12;
}

// MultiClusterConfig is described in istio.io documentation.
message MultiClusterConfig {
  // Enables the connection between two kubernetes clusters via their respective ingressgateway services. Use if the pods in each cluster cannot directly talk to one another.
  bool enabled = 1;
}

// NodeAgentConfig is a set of configuration parameters for Node Agent Daemonset.
message NodeAgentConfig {
  // Controls whether Node Agent is enabled.
  bool enabled = 1;

  // Environment variables passed to the Node Agent container.
  //
  // Examples:
  // env:
  //   ENV_VAR_1: value1
  //   ENV_VAR_2: value2
  // 	Env          map[string]interface{} `json:"env,omitempty"`

  // Image name for the Node Agent DaemonSet.
  string image = 2;

  // K8s node selector.
  //
  // See https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector
  // NodeSelector map[string]interface{} `json:"nodeSelector,omitempty"`
}

// OutboundTrafficPolicyConfig is described in istio.io documentation.
message OutboundTrafficPolicyConfig {
  // Specifies the sidecar's default behavior when handling outbound traffic from the application.
  enum mode {
    //outbound traffic to unknown destinations will be allowed, in case there are no services or ServiceEntries for the destination port
    ALLOW_ANY = 0;
    //restrict outbound traffic to services defined in the service registry as well as those defined through ServiceEntries
    REGISTRY_ONLY = 1;
  }
}

// PilotConfig is a set of configuration parameters for Pilot.
message PilotConfig {
  // Controls whether Pilot is enabled.
  bool enabled = 1;

  // Controls whether a HorizontalPodAutoscaler is installed for Pilot.
  bool autoscaleEnabled = 2;

  // Minimum number of replicas in the HorizontalPodAutoscaler for Pilot.
  uint32 autoscaleMin = 3;

  // Maximum number of replicas in the HorizontalPodAutoscaler for Pilot.
  uint32 autoscaleMax = 4;

  // Number of replicas in the Pilot Deployment.
  uint32 replicaCount = 5;

  // Image name used for Pilot.
  //
  // This can be set either to image name if hub is also set, or can be set to the full hub:name string.
  //
  // Examples: custom-pilot, docker.io/someuser:custom-pilot
  string image = 6;

  // Controls whether a sidecar proxy is installed in the Pilot pod.
  //
  // Setting to true installs a proxy in the Pilot pod, used primarily for collecting Pilot telemetry.
  bool sidecar = 7;

  // Trace sampling fraction.
  //
  // Used to set the fraction of time that traces are sampled. Higher values are more accurate but add CPU overhead.
  //
  // Allowed values: 0.0 to 1.0
  double traceSampling = 8;

  // K8s resources settings.
  //
  // See https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#resource-requests-and-limits-of-pod-and-container
  k8s.io.api.core.v1.ResourceRequirements resources = 9;

  // Namespace that the configuration management feature is installed into, if different from Pilot namespace.
  string configNamespace = 10;

  // Target CPU utilization used in HorizontalPodAutoscaler.
  //
  // See https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/
  CPUTargetUtilizationConfig cpu = 11;

  // K8s node selector.
  //
  // See https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector
  // NodeSelector                     map[string]interface{}      `json:"nodeSelector,omitempty"`

  // Maximum duration that a sidecar can be connected to a pilot.
  //
  // This setting balances out load across pilot instances, but adds some resource overhead.
  //
  // Examples: 300s, 30m, 1h
  google.protobuf.Duration keepaliveMaxServerConnectionAge = 12;

  // Labels that are added to Pilot pods.
  //
  // See https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/
  map<string, string> deploymentLabels = 13;

  // Used to override control plane networks.
  // 	MeshNetworks                     map[string]interface{}      `json:"meshNetworks,omitempty"`

  // Pod anti-affinity label selector.
  //
  // Specify the pod anti-affinity that allows you to constrain which nodes
  // your pod is eligible to be scheduled based on labels on pods that are
  // already running on the node rather than based on labels on nodes.
  // There are currently two types of anti-affinity:
  //    "requiredDuringSchedulingIgnoredDuringExecution"
  //    "preferredDuringSchedulingIgnoredDuringExecution"
  // which denote “hard” vs. “soft” requirements, you can define your values
  // in "podAntiAffinityLabelSelector" and "podAntiAffinityTermLabelSelector"
  // correspondingly.
  // See https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity
  //
  // Examples:
  // podAntiAffinityLabelSelector:
  //  - key: security
  //    operator: In
  //    values: S1,S2
  //    topologyKey: "kubernetes.io/hostname"
  //  This pod anti-affinity rule says that the pod requires not to be scheduled
  //  onto a node if that node is already running a pod with label having key
  //  “security” and value “S1”.
  // 	PodAntiAffinityLabelSelector     []map[string]interface{}    `json:"podAntiAffinityLabelSelector"`

  // See PodAntiAffinityLabelSelector.
  // 	PodAntiAffinityTermLabelSelector []map[string]interface{}    `json:"podAntiAffinityTermLabelSelector"`

  // Configuration settings passed to Pilot as a ConfigMap.
  //
  // This controls whether the mesh config map, generated from values.yaml is generated.
  // If false, pilot wil use default values or user-supplied values, in that order of preference.
  bool configMap = 14;

  // Controls legacy k8s ingress. Only one pilot profile should enable ingress support.
  PilotIngressConfig ingress = 15;

  // Controls whether Pilot is configured through the Mesh Control Protocol (MCP).
  //
  // If set to true, Pilot requires an MCP server (like Galley) to be installed.
  bool useMCP = 16;

  // Environment variables passed to the Pilot container.
  //
  // Examples:
  // env:
  //   ENV_VAR_1: value1
  //   ENV_VAR_2: value2
  map<string, string> env = 17;

  // Controls whether Istio policy is applied to Pilot.
  PilotPolicyConfig policy = 18;

  // Controls whether telemetry is exported for Pilot.
  PilotTelemetryConfig telemetry = 19;
}

// Controls legacy k8s ingress. Only one pilot profile should enable ingress support.
message PilotIngressConfig {
  // Sets the type ingress service for Pilot.
  //
  // If empty, node-port is assumed.
  //
  // Allowed values: node-port, istio-ingressgateway, ingress
  string ingressService = 1;

  // Mode for the ingress controller.
  enum ingressControllerMode {
    // Selects all Ingress resources, with or without Istio annotation.
    DEFAULT = 0;
    // Selects only resources with istio annotation.
    STRICT = 1;
    // No ingress or sync.
    OFF = 2;
  }
  // If mode is STRICT, this value must be set on "kubernetes.io/ingress.class" annotation to activate.
  string ingressClass = 3;
}

// Controls whether Istio policy is applied to Pilot.
message PilotPolicyConfig {
  bool enabled = 1;
}

// Controls whether telemetry is exported for Pilot.
message PilotTelemetryConfig {
  bool enabled = 1;
}

// PortsConfig is described in istio.io documentation.
message PortsConfig {
  string name = 1;

  int32 port = 2;

  int32 nodePort = 3;

  int32 targetPort = 4;
}

// PrometheusConfig is described in istio.io documentation.
message PrometheusConfig {
  bool createPrometheusResource = 1;

  bool enabled = 2;

  uint32 replicaCount = 3;

  string hub = 4;

  string tag = 5;

  string retention = 6;

  // 	NodeSelector             map[string]interface{}    `json:"nodeSelector,omitempty"`
  google.protobuf.Duration scrapeInterval = 7;

  string contextPath = 8;

  AddonIngressConfig ingress = 9;

  PrometheusServiceConfig service = 10;

  PrometheusSecurityConfig security = 11;
}

// Configuration parameters for Prometheus adapter in mixer
message PrometheusMixerAdapterConfig {
  // Enables the Prometheus adapter in Mixer.
  bool enabled = 1;

  // Sets the duration after which Prometheus registry purges a metric.
  //
  // See: https://istio.io/docs/reference/config/policy-and-telemetry/adapters/prometheus/#Params
  google.protobuf.Duration metricsExpiryDuration = 2;
}

// PrometheusSecurityConfig is described in istio.io documentation.
message PrometheusSecurityConfig {
  bool enabled = 1;
}

// PrometheusServiceConfig is described in istio.io documentation.
message PrometheusServiceConfig {
  // 	Annotations map[string]interface{}           `json:"annotations,omitempty"`
  PrometheusServiceNodePortConfig nodePort = 1;
}

// PrometheusServiceNodePortConfig is described in istio.io documentation.
message PrometheusServiceNodePortConfig {
  bool enabled = 1;

  uint32 port = 2;
}

// ProxyConfig is a set of configuration parameters for Proxy.
message ProxyConfig {
  // Specifies the path to write the sidecar access log file.
  string accessLogFile = 1;

  // Configures how and what fields are displayed in sidecar access log.
  string accessLogFormat = 2;

  // Configures the access log for sidecar to JSON or TEXT
  enum accessLogEncoding {
    JSON = 0;
    TEXT = 1;
  }

  // Controls whether automatic sidecar injection is enabled.
  enum autoInject {
    ENABLED = 0;
    DISABLED = 1;
  }

  // Domain for the cluster, default: "cluster.local".
  //
  // K8s allows this to be customized, see https://kubernetes.io/docs/tasks/administer-cluster/dns-custom-nameservers/
  string clusterDomain = 5;

  // Per Component log level for proxy, applies to gateways and sidecars.
  //
  // If a component level is not set, then the global "logLevel" will be used. If left empty, "misc:error" is used.
  string componentLogLevel = 6;

  // Controls number of proxy worker threads.
  //
  // If set to 0 (default), then start worker thread for each CPU thread/core.
  uint32 concurrency = 7;

  // Configures the DNS refresh rate for Envoy cluster of type STRICT_DNS.
  //
  // This must be given it terms of seconds. For example, 300s is valid but 5m is invalid.
  google.protobuf.Duration dnsRefreshRate = 8;

  // Enables core dumps for newly injected sidecars.
  //
  // If set, newly injected sidecars will have core dumps enabled.
  bool enableCoreDump = 9;

  // Configures Envoy Metrics Service.
  EnvoyMetricsConfig envoyMetricsService = 10;

  // Configures statsd export in Envoy.
  EnvoyMetricsConfig envoyStatsd = 11;

  // Specifies the Istio ingress ports not to capture.
  string excludeInboundPorts = 12;

  // Lists the excluded IP ranges of Istio egress traffic that the sidecar captures.
  string excludeIPRanges = 13;

  // Image name or path for the proxy, default: "proxyv2".
  //
  // If registry or tag are not specified, global.hub and global.tag are used.
  //
  // Examples: my-proxy (uses global.hub/tag), docker.io/myrepo/my-proxy:v1.0.0
  string image = 14;

  // Specifies the Istio ingress ports to capture.
  //
  // Examples:
  // "":          Redirect no inbound traffic to Envoy.
  // "*":         Redirect all inbound traffic to Envoy.
  // "80,8080":   Redirect only selected ports.
  string includeInboundPorts = 15;

  // Lists the IP ranges of Istio egress traffic that the sidecar captures.
  //
  // Example: "172.30.0.0/16,172.20.0.0/16"
  // This would only capture egress traffic on those two IP Ranges, all other outbound traffic would # be allowed by the sidecar."
  string includeIPRanges = 16;

  // Comma separated list of virtual interfaces whose inbound traffic (from VM) will be treated as outbound. By default, no interfaces are configured.
  string kubevirtInterfaces = 17;

  // Log level for proxy, applies to gateways and sidecars. If left empty, "warning" is used. Expected values are: trace\|debug\|info\|warning\|error\|critical\|off
  string logLevel = 18;

  // Enables privileged securityContext for the istio-proxy container.
  //
  // See https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  bool privileged = 19;

  // Sets the initial delay for readiness probes in seconds.
  uint32 readinessInitialDelaySeconds = 20;

  // Sets the interval between readiness probes in seconds.
  uint32 readinessPeriodSeconds = 21;

  // Sets the number of successive failed probes before indicating readiness failure.
  uint32 readinessFailureThreshold = 22;

  // Default port used for the Pilot agent's health checks.
  uint32 statusPort = 23;

  // K8s resources settings.
  //
  // See https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#resource-requests-and-limits-of-pod-and-container
  k8s.io.api.core.v1.ResourceRequirements resources = 24;

  // Specifies which tracer to use.
  enum tracer {
    ZIPKIN = 0;
    LIGHTSTEP = 1;
    DATADOG = 2;
  }
}

// ProxyInitConfig is described in istio.io documentation.
message ProxyInitConfig {
  string image = 1;
}

// ResourcesRequestsConfig is described in istio.io documentation.
message ResourcesRequestsConfig {
  string cpu = 1;

  string memory = 2;
}

// SDSConfig is described in istio.io documentation.
message SDSConfig {
  bool enabled = 1;

  // Specifies the Unix Domain Socket through which Envoy communicates with NodeAgent SDS to get key/cert for mTLS.
  string udsPath = 2;

  // Enables SDS use of k8s sa normal JWT to request for certificates.
  bool useNormalJwt = 3;

  // Enables SDS use of trustworthy JWT to request for certificates.
  bool useTrustworthyJwt = 4;
}

// SecretVolume is described in istio.io documentation.
message SecretVolume {
  string mountPath = 1;

  string name = 2;

  string secretName = 3;
}

// SecurityConfig is a set of configuration parameters for Citadel.
message SecurityConfig {
  // Controls whether Citadel is enabled.
  bool enabled = 1;

  // Number of replicas in the Citadel Deployment.
  uint32 replicaCount = 2;

  // Image name used for Citadel.
  //
  // This can be set either to image name if hub is also set, or can be set to the full hub:name string.
  //
  // Examples: custom-citadel, docker.io/someuser:custom-citadel
  string image = 3;

  // Controls whether self-signed CA is used for citadel to generate the certificate/key pair.
  //
  // Setting to false if you want to use your own root CA for Citade Deployment.
  bool selfSigned = 4;

  // The trust domain corresponds to the trust root of a system
  // Refer to https://github.com/spiffe/spiffe/blob/master/standards/SPIFFE-ID.md#21-trust-domain
  // Indicate the domain used in SPIFFE identity URL
  // The default depends on the environment.
  //   kubernetes: cluster.local
  //    else:  default dns domain
  string trustDomain = 5;

  // The DNS Certs specifies the customized DNS name and corresponding service account.
  //
  // Example:
  //   istio-pilot-service-account.istio-control: istio-pilot.istio-control.svc
  //   istio-galley-service-account.istio-config: istio-galley.istio-config.svc
  map<string, string> dnsCerts = 6;

  // Controls whether the mesh-wide authentication policy is created or not.
  //
  // Setting to true creates the mesh-wide authentication policy with name "default".
  bool createMeshPolicy = 7;

  // K8s node selector.
  //
  // See https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector
  // NodeSelector     map[string]interface{} `json:"nodeSelector,omitempty"`
}

// ServiceConfig is described in istio.io documentation.
message ServiceConfig {
  // 	Annotations  map[string]interface{} `json:"annotations,omitempty"`
  uint32 externalPort = 1;

  string name = 2;
  // Type         v1.ServiceType     `json:"type,omitempty"`
}

// SidecarInjectorConfig is described in istio.io documentation.
message SidecarInjectorConfig {
  // Controls whether Sidecar Injector is enabled.
  bool enabled = 1;

  // Enables sidecar auto-injection in namespaces by default.
  bool enableNamespacesByDefault = 2;

  // Image name used for Sidecar Injector.
  //
  // This can be set either to image name if hub is also set, or can be set to the full hub:name string.
  //
  // Examples: custom-sidecar_injector, docker.io/someuser:custom-sidecar_injector
  string image = 3;

  // K8s node selector. Each component can overwrite the default values by adding its node selector block in the relevant section and setting the desired values.
  //
  // See https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector
  // 	NodeSelector                     map[string]interface{}   `json:"nodeSelector,omitempty"`

  // Instructs Istio to not inject the sidecar on those pods, based on labels that are present in those pods.
  //
  // Annotations in the pods have higher precedence than the label selectors.
  // Order of evaluation: Pod Annotations → NeverInjectSelector → AlwaysInjectSelector → Default Policy.
  // See https://istio.io/docs/setup/kubernetes/additional-setup/sidecar-injection/#more-control-adding-exceptions
  // 	NeverInjectSelector              []map[string]interface{} `json:"neverInjectSelector,omitempty"`

  // See NeverInjectSelector
  //  AlwaysInjectSelector             []map[string]interface{} `json:"alwaysInjectSelector,omitempty"`

  // Pod anti-affinity label selector.
  //
  // Specify the pod anti-affinity that allows you to constrain which nodes
  // your pod is eligible to be scheduled based on labels on pods that are
  // already running on the node rather than based on labels on nodes.
  // There are currently two types of anti-affinity:
  //    "requiredDuringSchedulingIgnoredDuringExecution"
  //    "preferredDuringSchedulingIgnoredDuringExecution"
  // which denote “hard” vs. “soft” requirements, you can define your values
  // in "podAntiAffinityLabelSelector" and "podAntiAffinityTermLabelSelector"
  // correspondingly.
  // See https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity
  //
  // Examples:
  // podAntiAffinityLabelSelector:
  //  - key: security
  //    operator: In
  //    values: S1,S2
  //    topologyKey: "kubernetes.io/hostname"
  //  This pod anti-affinity rule says that the pod requires not to be scheduled
  //  onto a node if that node is already running a pod with label having key
  //  “security” and value “S1”.
  //  PodAntiAffinityLabelSelector     []map[string]interface{}    `json:"podAntiAffinityLabelSelector"`

  // See PodAntiAffinityLabelSelector.
  //  PodAntiAffinityTermLabelSelector []map[string]interface{}    `json:"podAntiAffinityTermLabelSelector"`

  // Number of replicas in the Sidecar Injector Deployment.
  uint32 replicaCount = 4;

  //  If true, webhook or istioctl injector will rewrite PodSpec for liveness health check to redirect request to sidecar. This makes liveness check work even when mTLS is enabled.
  bool rewriteAppHTTPProbe = 5;

  // Controls whether self-signed CA is used for Sidecar Injector to generate the certificate/key pair.
  //
  // Setting to false if you want to use your own root CA.
  bool selfSigned = 6;
}

// Configuration parameters for stdio adapter in mixer, recommended for debug usage only.
message StdioMixerAdapterConfig {
  // Enable stdio adapter to output logs and metrics to local machine.
  bool enabled = 1;

  // Whether to output a console-friendly or json-friendly format.
  bool outputAsJson = 2;
}

// Configuration parameters for different tracing system.
message TracerConfig {
  // TracerDatadogConfig defines configuration for datadog tracer.
  TracerDatadogConfig datadog = 1;

  // TracerLightStepConfig defines configuration for LightStep tracer
  TracerLightStepConfig lightstep = 2;

  // TracerZipkinConfig defines configuration for existing zipkin tracer
  TracerZipkinConfig zipkin = 3;
}

// TracerDatadogConfig defines configuration for datadog tracing.
message TracerDatadogConfig {
  // Specifies address of datadog instance in host:port format for reporting trace data.
  string address = 1;
}

// TracerLightStepConfig defines configuration for LightStep tracer
message TracerLightStepConfig {
  // Sets the lightstep satellite pool address in host:port format for reporting trace data.
  string address = 1;

  // Sets the lightstep access token.
  string accessToken = 2;

  // Sets path to the file containing the cacert to use when verifying TLS.
  string cacertPath = 3;

  // Enables lightstep secure connection.
  bool secure = 4;
}

// TracerZipkinConfig defines configuration for existing zipkin tracer
message TracerZipkinConfig {
  // Specifies address of zipkin instance in host:port format for reporting trace data.
  //
  // Example: <zipkin-collector-service>.<zipkin-collector-namespace>:941
  string address = 1;
}

// TracingConfig defines configurations for different tracing system to be installed.
message TracingConfig {
  // Enables tracing systems to be installed.
  bool enabled = 1;

  // Controls legacy k8s ingress for addon tracing components.
  TracingIngressConfig ingress = 2;

  // Defines configuration for addon jaeger tracing.
  TracingJaegerConfig jaeger = 3;

  // K8s node selector.
  //
  // See https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector
  // NodeSelector map[string]interface{} `json:"nodeSelector,omitempty"`

  // Configures which tracing system to be installed.
  string provider = 4;

  // Controls K8s service for addon tracing components.
  ServiceConfig service = 5;

  // Defines configuration for addon zipkin tracing.
  TracingZipkinConfig zipkin = 6;
}

// Controls legacy k8s ingress for addon tracing components.
message TracingIngressConfig {
  // Enables k8s ingress for addon tracing components.
  bool enabled = 1;
}

// Defines configuration for addon jaeger tracing.
message TracingJaegerConfig {
  // Image hub for jaeger tracing deployment.
  string hub = 1;

  // Image tag for jaeger tracing deployment.
  string tag = 2;

  // Configures jaeger in-memory storage setting.
  TracingJaegerMemoryConfig memory = 3;
}

// Configures jaeger in-memory storage setting.
message TracingJaegerMemoryConfig {
  // Set limit of the amount of traces stored in memory for jaeger
  uint32 max_traces = 1;
}

// TracingZipkinConfig is described in istio.io documentation.
message TracingZipkinConfig {
  // Image hub for zipkin tracing deployment.
  string hub = 1;

  // Image tag for zipkin tracing deployment.
  string tag = 2;

  // InitialDelaySeconds of livenessProbe for zipkin deployment
  uint32 probeStartupDelay = 3;

  // Container port for zipkin deployment
  uint32 queryPort = 4;

  // K8s resources settings.
  //
  // See https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#resource-requests-and-limits-of-pod-and-container
  k8s.io.api.core.v1.ResourceRequirements resources = 5;

  // Configure java heap opts for zipkin deployment
  string javaOptsHeap = 6;

  // Configures number of max spans to keep in zipkin memory storage.
  //
  // Example: A safe estimate is 1K of memory per span (each span with 2 annotations + 1 binary annotation), plus 100 MB for a safety buffer
  uint32 maxSpans = 7;

  // Configures GC values of JAVA_OPTS for zipkin deployment
  TracingZipkinNodeConfig node = 8;
}

// Configures GC values of JAVA_OPTS for zipkin deployment
message TracingZipkinNodeConfig {
  // Configures -XX:ConcGCThreads value of JAVA_OPTS for zipkin deployment
  uint32 cpus = 1;
}

message Values {
  CertManagerConfig certmanager = 1;

  CNIConfig istio_cni = 2;

  CoreDNSConfig istiocoredns = 3;

  GalleyConfig galley = 4;

  GatewaysConfig gateways = 5;

  GlobalConfig global = 6;

  // 	Grafana         map[string]interface{} `json:"grafana,omitempty"`
  MixerConfig mixer = 7;

  NodeAgentConfig nodeagent = 8;

  PilotConfig pilot = 9;

  PrometheusConfig prometheus = 10;

  SecurityConfig security = 11;

  SidecarInjectorConfig sidecarInjectorWebhook = 12;

  TracingConfig tracing = 13;
}

// ZeroVPNConfig is described in istio.io documentation.
message ZeroVPNConfig {
  bool enabled = 1;

  string suffix = 2;
}

