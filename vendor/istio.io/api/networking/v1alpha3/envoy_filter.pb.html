---
title: Envoy Filter
description: Customizing Envoy configuration generated by Istio.
location: https://istio.io/docs/reference/config/networking/v1alpha3/envoy-filter.html
layout: protoc-gen-docs
generator: protoc-gen-docs
number_of_entries: 21
---
<p><code>EnvoyFilter</code> provides a mechanism to customize the Envoy
configuration generated by Istio Pilot. Use EnvoyFilter to modify
values for certain fields, add specific filters, or even add
entirely new listeners, clusters, etc. This feature must be used
with care, as incorrect configurations could potentially
destabilize the entire mesh. Unlike other Istio networking objects,
EnvoyFilters are additively applied. Any number of EnvoyFilters can
exist for a given workload in a specific namespace. The order of
application of these EnvoyFilters is as follows: all EnvoyFilters
in the config <a href="https://istio.io/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig">root
namespace</a>,
followed by all matching EnvoyFilters in the workload&rsquo;s namespace.</p>

<p><strong>NOTE 1</strong>: Since this is break glass configuration, there will not
be any backward compatibility across different Istio releases. In
other words, this configuration is subject to change based on
internal implementation of Istio networking subsystem.</p>

<p><strong>NOTE 2</strong>: The envoy configuration provided through this mechanism
should be carefully monitored across Istio proxy version upgrades,
to ensure that deprecated fields are removed and replaced
appropriately.</p>

<p><strong>NOTE 3</strong>: When multiple EnvoyFilters are bound to the same
workload in a given namespace, all patches will be processed
sequentially in order of creation time.  The behavior is undefined
if multiple EnvoyFilter configurations conflict with each other.</p>

<p><strong>NOTE 4</strong>: *_To apply an EnvoyFilter resource to all workloads
(sidecars and gateways) in the system, define the resource in the
config <a href="https://istio.io/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig">root
namespace</a>,
without a workloadSelector.</p>

<p>The example below declares a global default EnvoyFilter resource in
the root namespace called <code>istio-config</code>, that adds a custom
protocol filter on all sidecars in the system, for outbound port
9307. The filter should be added before the terminating tcp_proxy
filter to take effect. In addition, it sets a 30s idle timeout for
all HTTP connections in both gateays and sidecars.</p>

<pre><code class="language-yaml">apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  name: custom-protocol
  namespace: istio-config # as defined in meshConfig resource.
spec:
  configPatches:
  - applyTo: NETWORK_FILTER
    match:
      context: SIDECAR_OUTBOUND # will match outbound listeners in all sidecars
      listener:
        portNumber: 9307
        filterChain:
          filter:
            name: &quot;envoy.tcp_proxy&quot;
    patch:
      operation: INSERT_BEFORE
      value:
        name: &quot;envoy.config.filter.network.custom_protocol&quot;
        config:
         ...
  - applyTo: NETWORK_FILTER # http connection manager is a filter in Envoy
    match:
      # context omitted so that this applies to both sidecars and gateways
      listener:
        filterChain:
          filter:
            name: &quot;envoy.http_connection_manager&quot;
    patch:
      operation: MERGE
      value:
        idle_timeout: 30s
</code></pre>

<p>The following example enables Envoy&rsquo;s Lua filter for all inbound
HTTP calls arriving at service port 8080 of the reviews service pod
with labels &ldquo;app: reviews&rdquo;, in the bookinfo namespace. The lua
filter calls out to an external service internal.org.net:8888 that
requires a special cluster definition in envoy. The cluster is also
added to the sidecar as part of this configuration.</p>

<pre><code class="language-yaml">apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  name: reviews-lua
  namespace: bookinfo
spec:
  workloadSelector:
    labels:
      app: reviews
  configPatches:
    # The first patch adds the lua filter to the listener/http connection manager
  - applyTo: HTTP_FILTER
    match:
      context: SIDECAR_INBOUND
      listener:
        portNumber: 8080
        filterChain:
          filter:
            name: &quot;envoy.http_connection_manager&quot;
            subFilter:
              name: &quot;envoy.router&quot;
    patch:
      operation: INSERT_BEFORE
      value: # lua filter specification
       name: envoy.lua
       config:
         inlineCode: |
           function envoy_on_request(request_handle)
             -- Make an HTTP call to an upstream host with the following headers, body, and timeout.
             local headers, body = request_handle:httpCall(
              &quot;lua_cluster&quot;,
              &lbrace;
               [&quot;:method&quot;] = &quot;POST&quot;,
               [&quot;:path&quot;] = &quot;/acl&quot;,
               [&quot;:authority&quot;] = &quot;internal.org.net&quot;
              },
             &quot;authorize call&quot;,
             5000)
           end
  # The second patch adds the cluster that is referenced by the lua code
  # cds match is omitted as a new cluster is being added
  - applyTo: CLUSTER
    match:
      context: SIDECAR_OUTBOUND
    patch:
      operation: ADD
      value: # cluster specification
        name: &quot;lua_cluster&quot;
        type: STRICT_DNS
        connect_timeout: 0.5s
        lb_policy: ROUND_ROBIN
        hosts:
        - socket_address:
            protocol: TCP
            address: &quot;internal.org.net&quot;
            port_value: 8888

</code></pre>

<p>The following example overwrites certain fields (HTTP idle timeout
and X-Forward-For trusted hops) in the HTTP connection manager in a
listener on the ingress gateway in istio-system namespace for the
SNI host app.example.com:</p>

<pre><code class="language-yaml">apiVersion: networking.istio.io/v1alpha3
kind: EnvoyFilter
metadata:
  name: hcm-tweaks
  namespace: istio-system
spec:
  workloadSelector:
    labels:
      istio: ingress-gateway
  configPatches:
  - applyTo: NETWORK_FILTER # http connection manager is a filter in Envoy
    match:
      context: GATEWAY
      listener:
        filterChain:
          sni: app.example.com
          filter:
            name: &quot;envoy.http_connection_manager&quot;
    patch:
      operation: MERGE
      value:
        idle_timeout: 30s
        xff_num_trusted_hops: 5
</code></pre>

<h2 id="EnvoyFilter">EnvoyFilter</h2>
<section>
<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-workload_selector">
<td><code>workloadSelector</code></td>
<td><code><a href="https://istio.io/docs/reference/config/networking/v1alpha3/sidecar.html#WorkloadSelector">WorkloadSelector</a></code></td>
<td>
<p>Criteria used to select the specific set of pods/VMs on which
this patch configuration should be applied. If omitted, the set
of patches in this configuration will be applied to all workload
instances in the same namespace.  If omitted, the EnvoyFilter
patches will be applied to all workloads in the same
namespace. If the EnvoyFilter is present in the config root
namespace, it will be applied to all applicable workloads in any
namespace.</p>

</td>
</tr>
<tr id="EnvoyFilter-config_patches">
<td><code>configPatches</code></td>
<td><code><a href="#EnvoyFilter-EnvoyConfigObjectPatch">EnvoyFilter.EnvoyConfigObjectPatch[]</a></code></td>
<td>
<p>REQUIRED. One or more patches with match conditions.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-ApplyTo">EnvoyFilter.ApplyTo</h2>
<section>
<p>ApplyTo specifies where in the Envoy configuration, the given patch should be applied.</p>

<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-ApplyTo-INVALID">
<td><code>INVALID</code></td>
<td>
</td>
</tr>
<tr id="EnvoyFilter-ApplyTo-LISTENER">
<td><code>LISTENER</code></td>
<td>
<p>Applies the patch to the listener.</p>

</td>
</tr>
<tr id="EnvoyFilter-ApplyTo-FILTER_CHAIN">
<td><code>FILTER_CHAIN</code></td>
<td>
<p>Applies the patch to the filter chain.</p>

</td>
</tr>
<tr id="EnvoyFilter-ApplyTo-NETWORK_FILTER">
<td><code>NETWORK_FILTER</code></td>
<td>
<p>Applies the patch to the network filter chain, to modify an
existing filter or add a new filter.</p>

</td>
</tr>
<tr id="EnvoyFilter-ApplyTo-HTTP_FILTER">
<td><code>HTTP_FILTER</code></td>
<td>
<p>Applies the patch to the HTTP filter chain in the http
connection manager, to modify an existing filter or add a new
filter.</p>

</td>
</tr>
<tr id="EnvoyFilter-ApplyTo-ROUTE_CONFIGURATION">
<td><code>ROUTE_CONFIGURATION</code></td>
<td>
<p>Applies the patch to the Route configuration (rds output)
inside a HTTP connection manager. This does not apply to the
virtual host. Currently, only MERGE operation is allowed on the
route configuration objects.</p>

</td>
</tr>
<tr id="EnvoyFilter-ApplyTo-VIRTUAL_HOST">
<td><code>VIRTUAL_HOST</code></td>
<td>
<p>Applies the patch to a virtual host inside a route configuration.</p>

</td>
</tr>
<tr id="EnvoyFilter-ApplyTo-HTTP_ROUTE">
<td><code>HTTP_ROUTE</code></td>
<td>
<p>Applies the patch to a route object inside the matched virtual
host in a route configuration. Currently, only MERGE operation
is allowed on the route objects.</p>

</td>
</tr>
<tr id="EnvoyFilter-ApplyTo-CLUSTER">
<td><code>CLUSTER</code></td>
<td>
<p>Applies the patch to a cluster in a CDS output. Also used to add new clusters.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-ClusterMatch">EnvoyFilter.ClusterMatch</h2>
<section>
<p>Conditions specified in ClusterMatch must be met for the patch
to be applied to a cluster.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-ClusterMatch-port_number">
<td><code>portNumber</code></td>
<td><code>uint32</code></td>
<td>
<p>The service port for which this cluster was generated.  If
omitted, applies to clusters for any port.</p>

</td>
</tr>
<tr id="EnvoyFilter-ClusterMatch-service">
<td><code>service</code></td>
<td><code>string</code></td>
<td>
<p>The fully qualified service name for this cluster. If omitted,
applies to clusters for any service. For services defined
through service entries, the service name is same as the hosts
defined in the service entry.</p>

</td>
</tr>
<tr id="EnvoyFilter-ClusterMatch-subset">
<td><code>subset</code></td>
<td><code>string</code></td>
<td>
<p>The subset associated with the service. If omitted, applies to
clusters for any subset of a service.</p>

</td>
</tr>
<tr id="EnvoyFilter-ClusterMatch-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>The exact name of the cluster to match. To match a specific
cluster by name, such as the internally generated &ldquo;Passthrough&rdquo;
cluster, leave all fields in clusterMatch empty, except the
name.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-DeprecatedListenerMatch-ListenerProtocol">EnvoyFilter.DeprecatedListenerMatch.ListenerProtocol</h2>
<section>
<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-DeprecatedListenerMatch-ListenerProtocol-ALL">
<td><code>ALL</code></td>
<td>
<p>All protocols</p>

</td>
</tr>
<tr id="EnvoyFilter-DeprecatedListenerMatch-ListenerProtocol-HTTP">
<td><code>HTTP</code></td>
<td>
<p>HTTP or HTTPS (with termination) / HTTP2/gRPC</p>

</td>
</tr>
<tr id="EnvoyFilter-DeprecatedListenerMatch-ListenerProtocol-TCP">
<td><code>TCP</code></td>
<td>
<p>Any non-HTTP listener</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-DeprecatedListenerMatch-ListenerType">EnvoyFilter.DeprecatedListenerMatch.ListenerType</h2>
<section>
<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-DeprecatedListenerMatch-ListenerType-ANY">
<td><code>ANY</code></td>
<td>
<p>All listeners</p>

</td>
</tr>
<tr id="EnvoyFilter-DeprecatedListenerMatch-ListenerType-SIDECAR_INBOUND">
<td><code>SIDECAR_INBOUND</code></td>
<td>
<p>Inbound listener in sidecar</p>

</td>
</tr>
<tr id="EnvoyFilter-DeprecatedListenerMatch-ListenerType-SIDECAR_OUTBOUND">
<td><code>SIDECAR_OUTBOUND</code></td>
<td>
<p>Outbound listener in sidecar</p>

</td>
</tr>
<tr id="EnvoyFilter-DeprecatedListenerMatch-ListenerType-GATEWAY">
<td><code>GATEWAY</code></td>
<td>
<p>Gateway listener</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-EnvoyConfigObjectMatch">EnvoyFilter.EnvoyConfigObjectMatch</h2>
<section>
<p>One or more match conditions to be met before a patch is applied
to the generated configuration for a given proxy.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-EnvoyConfigObjectMatch-context">
<td><code>context</code></td>
<td><code><a href="#EnvoyFilter-PatchContext">EnvoyFilter.PatchContext</a></code></td>
<td>
<p>The specific config generation context to match on. Istio Pilot
generates envoy configuration in the context of a gateway,
inbound traffic to sidecar and outbound traffic from sidecar.</p>

</td>
</tr>
<tr id="EnvoyFilter-EnvoyConfigObjectMatch-proxy">
<td><code>proxy</code></td>
<td><code><a href="#EnvoyFilter-ProxyMatch">EnvoyFilter.ProxyMatch</a></code></td>
<td>
<p>Match on properties associated with a proxy.</p>

</td>
</tr>
<tr id="EnvoyFilter-EnvoyConfigObjectMatch-listener" class="oneof oneof-start">
<td><code>listener</code></td>
<td><code><a href="#EnvoyFilter-ListenerMatch">EnvoyFilter.ListenerMatch (oneof)</a></code></td>
<td>
<p>Match on envoy listener attributes.</p>

</td>
</tr>
<tr id="EnvoyFilter-EnvoyConfigObjectMatch-route_configuration" class="oneof">
<td><code>routeConfiguration</code></td>
<td><code><a href="#EnvoyFilter-RouteConfigurationMatch">EnvoyFilter.RouteConfigurationMatch (oneof)</a></code></td>
<td>
<p>Match on envoy HTTP route configuration attributes.</p>

</td>
</tr>
<tr id="EnvoyFilter-EnvoyConfigObjectMatch-cluster" class="oneof">
<td><code>cluster</code></td>
<td><code><a href="#EnvoyFilter-ClusterMatch">EnvoyFilter.ClusterMatch (oneof)</a></code></td>
<td>
<p>Match on envoy cluster attributes.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-EnvoyConfigObjectPatch">EnvoyFilter.EnvoyConfigObjectPatch</h2>
<section>
<p>Changes to be made to various envoy config objects.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-EnvoyConfigObjectPatch-apply_to">
<td><code>applyTo</code></td>
<td><code><a href="#EnvoyFilter-ApplyTo">EnvoyFilter.ApplyTo</a></code></td>
<td>
<p>Specifies where in the Envoy configuration, the patch should be
applied.  The match is expected to select the appropriate
object based on applyTo.  For example, an applyTo with
HTTP<em>FILTER is expected to have a match condition on the
listeners, with a network filter selection on
envoy.http</em>connection_manager and a sub filter selection on the
HTTP filter relative to which the insertion should be
performed. Similarly, an applyTo on CLUSTER should have a match
(if provided) on the cluster and not on a listener.</p>

</td>
</tr>
<tr id="EnvoyFilter-EnvoyConfigObjectPatch-match">
<td><code>match</code></td>
<td><code><a href="#EnvoyFilter-EnvoyConfigObjectMatch">EnvoyFilter.EnvoyConfigObjectMatch</a></code></td>
<td>
<p>Match on listener/route configuration/cluster.</p>

</td>
</tr>
<tr id="EnvoyFilter-EnvoyConfigObjectPatch-patch">
<td><code>patch</code></td>
<td><code><a href="#EnvoyFilter-Patch">EnvoyFilter.Patch</a></code></td>
<td>
<p>The patch to apply along with the operation.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-Filter-FilterType">EnvoyFilter.Filter.FilterType</h2>
<section>
<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-Filter-FilterType-INVALID">
<td><code>INVALID</code></td>
<td>
<p>placeholder</p>

</td>
</tr>
<tr id="EnvoyFilter-Filter-FilterType-HTTP">
<td><code>HTTP</code></td>
<td>
<p>Http filter</p>

</td>
</tr>
<tr id="EnvoyFilter-Filter-FilterType-NETWORK">
<td><code>NETWORK</code></td>
<td>
<p>Network filter</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-InsertPosition-Index">EnvoyFilter.InsertPosition.Index</h2>
<section>
<p>Index/position in the filter chain.</p>

<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-InsertPosition-Index-FIRST">
<td><code>FIRST</code></td>
<td>
<p>Insert first</p>

</td>
</tr>
<tr id="EnvoyFilter-InsertPosition-Index-LAST">
<td><code>LAST</code></td>
<td>
<p>Insert last</p>

</td>
</tr>
<tr id="EnvoyFilter-InsertPosition-Index-BEFORE">
<td><code>BEFORE</code></td>
<td>
<p>Insert before the named filter.</p>

</td>
</tr>
<tr id="EnvoyFilter-InsertPosition-Index-AFTER">
<td><code>AFTER</code></td>
<td>
<p>Insert after the named filter.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-ListenerMatch">EnvoyFilter.ListenerMatch</h2>
<section>
<p>Conditions specified in a listener match must be met for the
patch to be applied to a specific listener across all filter
chains, or a specific filter chain inside the listener.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-ListenerMatch-port_number">
<td><code>portNumber</code></td>
<td><code>uint32</code></td>
<td>
<p>The service port/gateway port to which traffic is being
sent/received. If not specified, matches all listeners. Even though
inbound listeners are generated for the instance/pod ports, only
service ports should be used to match listeners.</p>

</td>
</tr>
<tr id="EnvoyFilter-ListenerMatch-filter_chain">
<td><code>filterChain</code></td>
<td><code><a href="#EnvoyFilter-ListenerMatch-FilterChainMatch">EnvoyFilter.ListenerMatch.FilterChainMatch</a></code></td>
<td>
<p>Match a specific filter chain in a listener. If specified, the
patch will be applied to the filter chain (and a specific
filter if specified) and not to other filter chains in the
listener.</p>

</td>
</tr>
<tr id="EnvoyFilter-ListenerMatch-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>Match a specific listener by its name. The listeners generated
by Pilot are typically named as IP:Port.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-ListenerMatch-FilterChainMatch">EnvoyFilter.ListenerMatch.FilterChainMatch</h2>
<section>
<p>For listeners with multiple filter chains (e.g., inbound
listeners on sidecars with permissive mTLS, gateway listeners
with multiple SNI matches), the filter chain match can be used
to select a specific filter chain to patch.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-ListenerMatch-FilterChainMatch-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>The name assigned to the filter chain.</p>

</td>
</tr>
<tr id="EnvoyFilter-ListenerMatch-FilterChainMatch-sni">
<td><code>sni</code></td>
<td><code>string</code></td>
<td>
<p>The SNI value used by a filter chain&rsquo;s match condition.  This
condition will evaluate to false if the filter chain has no
sni match.</p>

</td>
</tr>
<tr id="EnvoyFilter-ListenerMatch-FilterChainMatch-transport_protocol">
<td><code>transportProtocol</code></td>
<td><code>string</code></td>
<td>
<p>Applies only to SIDECAR<em>INBOUND context. If non-empty, a
transport protocol to consider when determining a filter
chain match.  This value will be compared against the
transport protocol of a new connection, when it&rsquo;s detected by
the tls</em>inspector listener filter.</p>

<p>Accepted values include:</p>

<ul>
<li><code>raw_buffer</code> - default, used when no transport protocol is detected.</li>
<li><code>tls</code> - set when TLS protocol is detected by the TLS inspector.</li>
</ul>

</td>
</tr>
<tr id="EnvoyFilter-ListenerMatch-FilterChainMatch-application_protocols">
<td><code>applicationProtocols</code></td>
<td><code>string</code></td>
<td>
<p>Applies only to sidecars. If non-empty, a comma separated set
of application protocols to consider when determining a
filter chain match.  This value will be compared against the
application protocols of a new connection, when it&rsquo;s detected
by one of the listener filters such as the http_inspector.</p>

<p>Accepted values include: h2,http/1.1,http/1.0</p>

</td>
</tr>
<tr id="EnvoyFilter-ListenerMatch-FilterChainMatch-filter">
<td><code>filter</code></td>
<td><code><a href="#EnvoyFilter-ListenerMatch-FilterMatch">EnvoyFilter.ListenerMatch.FilterMatch</a></code></td>
<td>
<p>The name of a specific filter to apply the patch to. Set this
to envoy.http<em>connection</em>manager to add a filter or apply a
patch to the HTTP connection manager.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-ListenerMatch-FilterMatch">EnvoyFilter.ListenerMatch.FilterMatch</h2>
<section>
<p>Conditions to match a specific filter within a filter chain.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-ListenerMatch-FilterMatch-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>The filter name to match on.</p>

</td>
</tr>
<tr id="EnvoyFilter-ListenerMatch-FilterMatch-sub_filter">
<td><code>subFilter</code></td>
<td><code><a href="#EnvoyFilter-ListenerMatch-SubFilterMatch">EnvoyFilter.ListenerMatch.SubFilterMatch</a></code></td>
<td>
<p>The next level filter within this filter to match
upon. Typically used for HTTP Connection Manager filters and
Thrift filters.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-ListenerMatch-SubFilterMatch">EnvoyFilter.ListenerMatch.SubFilterMatch</h2>
<section>
<p>Conditions to match a specific filter within another
filter. This field is typically useful to match a HTTP filter
inside the envoy.http<em>connection</em>manager network filter. This
could also be applicable for thrift filters.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-ListenerMatch-SubFilterMatch-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>The filter name to match on.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-Patch">EnvoyFilter.Patch</h2>
<section>
<p>Patch specifies how the selected object should be modified.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-Patch-operation">
<td><code>operation</code></td>
<td><code><a href="#EnvoyFilter-Patch-Operation">EnvoyFilter.Patch.Operation</a></code></td>
<td>
<p>Determines how the patch should be applied.</p>

</td>
</tr>
<tr id="EnvoyFilter-Patch-value">
<td><code>value</code></td>
<td><code><a href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#struct">google.protobuf.Struct</a></code></td>
<td>
<p>The JSON config of the object being patched. This will be merged using
json merge semantics with the existing proto in the path.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-Patch-Operation">EnvoyFilter.Patch.Operation</h2>
<section>
<p>Operation denotes how the patch should be applied to the selected
configuration.</p>

<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-Patch-Operation-INVALID">
<td><code>INVALID</code></td>
<td>
</td>
</tr>
<tr id="EnvoyFilter-Patch-Operation-MERGE">
<td><code>MERGE</code></td>
<td>
<p>Merge the provided config with the generated config using
json merge semantics.</p>

</td>
</tr>
<tr id="EnvoyFilter-Patch-Operation-ADD">
<td><code>ADD</code></td>
<td>
<p>Add the provided config to an existing list (of listeners,
clusters, virtual hosts, network filters, or http
filters). This operation will be ignored when applyTo is set
to ROUTE<em>CONFIGURATION, or HTTP</em>ROUTE.</p>

</td>
</tr>
<tr id="EnvoyFilter-Patch-Operation-REMOVE">
<td><code>REMOVE</code></td>
<td>
<p>Remove the selected object from the list (of listeners,
clusters, virtual hosts, network filters, or http
filters). Does not require a value to be specified. This
operation will be ignored when applyTo is set to
ROUTE<em>CONFIGURATION, or HTTP</em>ROUTE.</p>

</td>
</tr>
<tr id="EnvoyFilter-Patch-Operation-INSERT_BEFORE">
<td><code>INSERT_BEFORE</code></td>
<td>
<p>Insert operation on an array of named objects. This operation
is typically useful only in the context of filters, where the
order of filters matter. For clusters and virtual hosts,
order of the element in the array does not matter. Insert
before the selected filter or sub filter. If no filter is
selected, the specified filter will be inserted at the front
of the list.</p>

</td>
</tr>
<tr id="EnvoyFilter-Patch-Operation-INSERT_AFTER">
<td><code>INSERT_AFTER</code></td>
<td>
<p>Insert operation on an array of named objects. This operation
is typically useful only in the context of filters, where the
order of filters matter. For clusters and virtual hosts,
order of the element in the array does not matter. Insert
after the selected filter or sub filter. If no filter is
selected, the specified filter will be inserted at the end
of the list.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-PatchContext">EnvoyFilter.PatchContext</h2>
<section>
<p>PatchContext selects a class of configurations based on the
traffic flow direction and workload type.</p>

<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-PatchContext-ANY">
<td><code>ANY</code></td>
<td>
<p>All listeners/routes/clusters in both sidecars and gateways.</p>

</td>
</tr>
<tr id="EnvoyFilter-PatchContext-SIDECAR_INBOUND">
<td><code>SIDECAR_INBOUND</code></td>
<td>
<p>Inbound listener/route/cluster in sidecar.</p>

</td>
</tr>
<tr id="EnvoyFilter-PatchContext-SIDECAR_OUTBOUND">
<td><code>SIDECAR_OUTBOUND</code></td>
<td>
<p>Outbound listener/route/cluster in sidecar.</p>

</td>
</tr>
<tr id="EnvoyFilter-PatchContext-GATEWAY">
<td><code>GATEWAY</code></td>
<td>
<p>Gateway listener/route/cluster.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-ProxyMatch">EnvoyFilter.ProxyMatch</h2>
<section>
<p>One or more properties of the proxy to match on.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-ProxyMatch-proxy_version">
<td><code>proxyVersion</code></td>
<td><code>string</code></td>
<td>
<p>A regular expression in golang regex format (RE2) that can be
used to select proxies using a specific version of istio
proxy. The Istio version for a given proxy is obtained from the
node metadata field ISTIO<em>VERSION supplied by the proxy when
connecting to Pilot. This value is embedded as an environment
variable (ISTIO</em>META<em>ISTIO</em>VERSION) in the Istio proxy docker
image. Custom proxy implementations should provide this metadata
variable to take advantage of the Istio version check option.</p>

</td>
</tr>
<tr id="EnvoyFilter-ProxyMatch-metadata">
<td><code>metadata</code></td>
<td><code>map&lt;string,&nbsp;string&gt;</code></td>
<td>
<p>Match on the node metadata supplied by a proxy when connecting
to Istio Pilot. Note that while Envoy&rsquo;s node metadata is of
type Struct, only string key-value pairs are processed by
Pilot. All keys specified in the metadata must match with exact
values. The match will fail if any of the specified keys are
absent or the values fail to match.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-RouteConfigurationMatch">EnvoyFilter.RouteConfigurationMatch</h2>
<section>
<p>Conditions specified in RouteConfigurationMatch must be met for
the patch to be applied to a route configuration object or a
specific virtual host within the route configuration.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-RouteConfigurationMatch-port_number">
<td><code>portNumber</code></td>
<td><code>uint32</code></td>
<td>
<p>The service port number or gateway server port number for which
this route configuration was generated. If omitted, applies to
route configurations for all ports.</p>

</td>
</tr>
<tr id="EnvoyFilter-RouteConfigurationMatch-port_name">
<td><code>portName</code></td>
<td><code>string</code></td>
<td>
<p>Applicable only for GATEWAY context. The gateway server port
name for which this route configuration was generated.</p>

</td>
</tr>
<tr id="EnvoyFilter-RouteConfigurationMatch-gateway">
<td><code>gateway</code></td>
<td><code>string</code></td>
<td>
<p>The Istio gateway config&rsquo;s namespace/name for which this route
configuration was generated. Applies only if the context is
GATEWAY. Should be in the namespace/name format. Use this field
in conjunction with the portNumber and portName to accurately
select the Envoy route configuration for a specific HTTPS
server within a gateway config object.</p>

</td>
</tr>
<tr id="EnvoyFilter-RouteConfigurationMatch-vhost">
<td><code>vhost</code></td>
<td><code><a href="#EnvoyFilter-RouteConfigurationMatch-VirtualHostMatch">EnvoyFilter.RouteConfigurationMatch.VirtualHostMatch</a></code></td>
<td>
<p>Match a specific virtual host in a route configuration and
apply the patch to the virtual host.</p>

</td>
</tr>
<tr id="EnvoyFilter-RouteConfigurationMatch-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>Route configuration name to match on. Can be used to match a
specific route configuration by name, such as the internally
generated &ldquo;http_proxy&rdquo; route configuration for all sidecars.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-RouteConfigurationMatch-RouteMatch">EnvoyFilter.RouteConfigurationMatch.RouteMatch</h2>
<section>
<p>Match a specific route inside a virtual host in a route configuration.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-RouteConfigurationMatch-RouteMatch-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>The Route objects generated by default are named as
&ldquo;default&rdquo;.  Route objects generated using a virtual service
will carry the name used in the virtual service&rsquo;s HTTP
routes.</p>

</td>
</tr>
<tr id="EnvoyFilter-RouteConfigurationMatch-RouteMatch-action">
<td><code>action</code></td>
<td><code><a href="#EnvoyFilter-RouteConfigurationMatch-RouteMatch-Action">EnvoyFilter.RouteConfigurationMatch.RouteMatch.Action</a></code></td>
<td>
<p>Match a route with specific action type.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-RouteConfigurationMatch-RouteMatch-Action">EnvoyFilter.RouteConfigurationMatch.RouteMatch.Action</h2>
<section>
<p>Action refers to the route action taken by Envoy when a http route matches.</p>

<table class="enum-values">
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-RouteConfigurationMatch-RouteMatch-Action-ANY">
<td><code>ANY</code></td>
<td>
<p>All three route actions</p>

</td>
</tr>
<tr id="EnvoyFilter-RouteConfigurationMatch-RouteMatch-Action-ROUTE">
<td><code>ROUTE</code></td>
<td>
<p>Route traffic to a cluster / weighted clusters.</p>

</td>
</tr>
<tr id="EnvoyFilter-RouteConfigurationMatch-RouteMatch-Action-REDIRECT">
<td><code>REDIRECT</code></td>
<td>
<p>Redirect request.</p>

</td>
</tr>
<tr id="EnvoyFilter-RouteConfigurationMatch-RouteMatch-Action-DIRECT_RESPONSE">
<td><code>DIRECT_RESPONSE</code></td>
<td>
<p>directly respond to a request with specific payload.</p>

</td>
</tr>
</tbody>
</table>
</section>
<h2 id="EnvoyFilter-RouteConfigurationMatch-VirtualHostMatch">EnvoyFilter.RouteConfigurationMatch.VirtualHostMatch</h2>
<section>
<p>Match a specific virtual host inside a route configuration.</p>

<table class="message-fields">
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr id="EnvoyFilter-RouteConfigurationMatch-VirtualHostMatch-name">
<td><code>name</code></td>
<td><code>string</code></td>
<td>
<p>The VirtualHosts objects generated by Istio are named as
host:port, where the host typically corresponds to the
VirtualService&rsquo;s host field or the hostname of a service in the
registry.</p>

</td>
</tr>
<tr id="EnvoyFilter-RouteConfigurationMatch-VirtualHostMatch-route">
<td><code>route</code></td>
<td><code><a href="#EnvoyFilter-RouteConfigurationMatch-RouteMatch">EnvoyFilter.RouteConfigurationMatch.RouteMatch</a></code></td>
<td>
<p>Match a specific route within the virtual host.</p>

</td>
</tr>
</tbody>
</table>
</section>
