# This file provides some defaults for integration testing.
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  name: install
spec:
  components:
    ingressGateways:
    - name: istio-ingressgateway
      enabled: true
      k8s:
        service:
          ports:
          ## Default ports
          - port: 15021
            targetPort: 15021
            name: status-port
          - port: 80
            targetPort: 8080
            name: http2
          - port: 443
            targetPort: 8443
            name: https
    - name: istio-ingressgateway-quic
      enabled: true
      k8s:
        service:
          ports:
          - port: 443
            targetPort: 8443
            name: http3
            protocol: UDP
        serviceAnnotations:
          # This annotation is required for aws platform clusters.
          # Otherwise, the service will stuck in the "pending" state.
          # The annotation creates the load balancer and "Network LB"
          # instead of the default "Application LB".
          service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
        overlays:
        - kind: Service
          name: istio-ingressgateway-quic
          patches:
          - path: metadata.labels.istio-quic-svc
            value: "true"
  values:
    pilot:
      env:
        PILOT_ENABLE_QUIC_LISTENERS: true
